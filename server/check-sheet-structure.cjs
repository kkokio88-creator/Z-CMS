const http = require('http');

async function getPreview(sheetName) {
  return new Promise((resolve) => {
    const url = `/api/sheets/preview?url=1GUo9wmwmm14zhb_gtpoNrDBfJ5DqEm5pf4jpRsto-JI&sheet=${encodeURIComponent(sheetName)}`;

    http.get({ hostname: 'localhost', port: 3001, path: url }, (res) => {
      let body = '';
      res.on('data', chunk => body += chunk);
      res.on('end', () => resolve(JSON.parse(body)));
    });
  });
}

async function main() {
  const sheets = ['매출', '판매', '구매', '경비', '폐기'];

  console.log('\n');
  console.log('╔══════════════════════════════════════════════════════════════════════════╗');
  console.log('║                    Google Sheets 구조 수정 가이드                        ║');
  console.log('╚══════════════════════════════════════════════════════════════════════════╝');

  for (const sheet of sheets) {
    const result = await getPreview(sheet);

    console.log(`\n${'═'.repeat(76)}`);
    console.log(`📊 [${sheet}] 시트`);
    console.log('═'.repeat(76));

    if (result.success) {
      console.log('\n🔴 현재 구조 (처음 6행):');
      console.log('┌' + '─'.repeat(74) + '┐');

      // 헤더
      const headerPreview = (result.headers || []).slice(0, 5).map(h =>
        String(h || '').substring(0, 12).padEnd(12)
      ).join(' | ');
      console.log(`│ 1행(헤더): ${headerPreview.substring(0, 60).padEnd(61)}│`);

      // 데이터
      (result.data || []).slice(0, 5).forEach((row, i) => {
        const rowPreview = (row || []).slice(0, 5).map(c =>
          String(c || '').substring(0, 12).padEnd(12)
        ).join(' | ');
        console.log(`│ ${i+2}행:      ${rowPreview.substring(0, 60).padEnd(61)}│`);
      });
      console.log('└' + '─'.repeat(74) + '┘');
    }
  }

  // 수정 가이드
  console.log('\n\n');
  console.log('╔══════════════════════════════════════════════════════════════════════════╗');
  console.log('║                         📝 수정 가이드                                   ║');
  console.log('╚══════════════════════════════════════════════════════════════════════════╝');

  console.log(`
┌─────────────────────────────────────────────────────────────────────────────┐
│ 📊 [매출] 시트 수정                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ 현재: 1행에 설명문, 3행에 실제 헤더                                         │
│                                                                             │
│ ✅ 권장 구조:                                                               │
│ ┌────────────┬────────────┬────────────┬────────────┬────────────┐         │
│ │ 1행(헤더)  │ 생산일     │ 자사       │ 쿠팡       │ 컬리       │ 매출총액 │
│ │ 2행(데이터)│ 2026-01-01 │ 150000     │ 500000     │ 300000     │ 950000   │
│ │ 3행(데이터)│ 2026-01-02 │ 180000     │ 520000     │ 280000     │ 980000   │
│ └────────────┴────────────┴────────────┴────────────┴────────────┘         │
│                                                                             │
│ 📌 조치: 1-2행 설명문 삭제 또는 별도 시트로 이동                            │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📊 [판매] 시트 수정                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ 현재: 1행에 "판매현황" 제목, 2행에 실제 헤더                                │
│                                                                             │
│ ✅ 권장 구조:                                                               │
│ ┌────────────┬────────────┬────────────┬────────────┬────────────┐         │
│ │ 1행(헤더)  │ 품목코드   │ 품목명     │ 일별       │ 거래처별   │ 수량     │
│ │ 2행(데이터)│ BAN_P_0008 │ 고추를곁.. │ 2026/01/01 │ 쿠팡       │ 50       │
│ └────────────┴────────────┴────────────┴────────────┴────────────┘         │
│                                                                             │
│ 📌 조치: 1행 "판매현황" 제목 삭제                                           │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📊 [구매] 시트 - ✅ 현재 구조 양호                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ • 1행에 헤더, 2행부터 데이터 - 수정 불필요                                  │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📊 [경비] 시트 수정                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ 현재: 1행에 긴 설명문                                                       │
│                                                                             │
│ ✅ 권장 구조:                                                               │
│ ┌────────────┬────────────┬────────────┬────────────┬────────────┐         │
│ │ 1행(헤더)  │ 검침일     │ 전기(kWh)  │ 수도(톤)   │ 가스(m³)   │ 비고     │
│ │ 2행(데이터)│ 2026-01-01 │ 1250       │ 45         │ 120        │          │
│ └────────────┴────────────┴────────────┴────────────┴────────────┘         │
│                                                                             │
│ 📌 조치: 설명문을 별도 시트나 메모로 이동, 1행을 헤더로 변경                │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 📊 [폐기] 시트 수정                                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ 현재: 병합된 셀, 불규칙한 구조                                              │
│                                                                             │
│ ✅ 권장 구조:                                                               │
│ ┌────────────┬────────────┬────────────┬────────────┬────────────┐         │
│ │ 1행(헤더)  │ 생산일     │ 생산수량   │ 일반반찬   │ 전전처리   │ 냉동국   │
│ │ 2행(데이터)│ 2026-02-03 │ 7154       │ 100        │ 50         │ 30       │
│ └────────────┴────────────┴────────────┴────────────┴────────────┘         │
│                                                                             │
│ 📌 조치:                                                                    │
│   1. 셀 병합 해제                                                           │
│   2. 1행에 명확한 헤더 작성                                                 │
│   3. 날짜 형식 통일 (YYYY-MM-DD)                                            │
└─────────────────────────────────────────────────────────────────────────────┘
`);

  console.log('\n');
  console.log('╔══════════════════════════════════════════════════════════════════════════╗');
  console.log('║                      🔧 빠른 수정 체크리스트                             ║');
  console.log('╚══════════════════════════════════════════════════════════════════════════╝');
  console.log(`
   □ [매출] 1-2행 설명문 삭제 → 3행을 1행으로 이동
   □ [판매] 1행 "판매현황" 삭제 → 2행을 1행으로 이동
   □ [구매] 수정 불필요 ✅
   □ [경비] 1행 설명문 삭제 → 헤더행 새로 작성
   □ [폐기] 셀 병합 해제 → 1행 헤더 정리

   💡 팁: 설명문은 시트 상단이 아닌 "메모" 또는 별도 "설명" 시트에 보관하세요.
`);
}

main().catch(console.error);
