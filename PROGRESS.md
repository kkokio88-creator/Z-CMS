# Z-CMS 고도화 마스터 진행 상태

> **기반 문서**: `02 기능명세서 고도화 수정사항.md`
> **마지막 업데이트**: 2026-02-09
> **상태 범례**: ✅ 완료 | 🔧 부분완료 | ❌ 미착수 | ⏸ 보류

---

## ====== 명세서 Phase 1: 핵심 고정값 제거 + 채널 어드민 (1~2주) ======

### P1-1. 이익 = 매출 × 0.3 → 진짜 남는 돈(CM) 계산 [❌ 미착수]
- **위치**: `insightService.ts` — `computeRevenueTrend()`, `computeChannelRevenue()`
- **현재**: 이익 = 매출 × defaultMarginRate (config에서 가져오지만 여전히 고정비율)
- **목표**: 3단계 이익 계산 (제품이익 → 채널이익 → 사업부이익)
  - 1단계: 판매가 - 직접재료비(원재료+부재료)
  - 2단계: 1단계 - 채널별 변동비 (ChannelCostAdmin 데이터 활용)
  - 3단계: 2단계 - 채널 전담 고정비
- **관련**: 명세서 §3.1, §9
- **우선도**: 🔴 가장 시급

### P1-2. 폐기비용 = 개당 1,000원 → 품목별 실제 단가 [🔧 부분완료]
- **완료**: config.wasteUnitCost로 설정 가능해짐 (하드코딩 제거)
- **미완료**: 품목별 실제 단가 기반 계산 (폐기비용 = 폐기량 × 해당 품목 단가)
- **위치**: `insightService.ts` — `computeWasteAnalysis()`, `ProductionBomView.tsx`
- **관련**: 명세서 §5.2

### P1-3. 노무비 = 25% → 반별 생산성 관리 [❌ 미착수]
- **현재**: 노무비 = (원+부+경) × config.laborCostRatio
- **목표**: 반별(조별) 생산성 입력 화면 + labor_daily_records 테이블
- **관련**: 명세서 §4.4
- **DB 필요**: labor_daily_records 테이블

### P1-4. 경비 = 구매액 × 5% → 고정비 + 변동비 분리 [🔧 부분완료]
- **완료**: config.monthlyFixedOverhead, variableOverheadPerUnit 필드 추가 + 설정 UI
- **미완료**: insightService의 computeCostBreakdown()에서 실제 적용 안 됨
- **목표**: 일일경비 = (월고정경비/영업일수) + (변동경비단가 × 당일생산량)
- **관련**: 명세서 §4.5

### P1-5. 서비스 수준 4개 → 자유 선택 [✅ 완료]
- erfInv/getZScore 수학 함수 구현 (1~99% 연속 지원)
- `orderingService.ts`에 구현됨

### P1-6. 안전재고 공식 개선 [✅ 완료]
- SS = Z × √(L×σd² + μd²×σL²) — 수요+납품기간 변동 모두 반영
- `orderingService.ts`에 구현됨

### P1-7. API 키 .env 이동 + 소스코드 기본값 제거 [✅ 완료]
- ecountService DEFAULT_CONFIG 하드코딩 완전 제거됨

### P1-8. 채널 비용 관리 어드민 [🔧 부분완료]
- **완료**: ChannelCostAdmin 컴포넌트 (기본 변동비/고정비 입력)
- **미완료**: 비용유형 세분화(매출대비%/건당원/월고정원), DB 연동, 3단계 이익 계산 연동
- **관련**: 명세서 §3.4

---

## ====== 명세서 Phase 2: 보안 및 안정성 (2~3주) ======

### P2-1. 사용자별 데이터 접근 권한 [❌ 미착수]
### P2-2. 입력값 형식 검증 [✅ 완료]
- `src/validation/schemas.ts` — Zod 스키마 구현됨

### P2-3. 화면별 오류 격리 [✅ 완료]
- `src/components/ErrorBoundary.tsx` — 6개 뷰 모두 적용

### P2-4. 증분 동기화 (바뀐 데이터만) [❌ 미착수]
- sync_log의 마지막 동기화 시각 이후 변경분만 가져오기

### P2-5. 트랜잭션 (여러 테이블 동시 저장) [❌ 미착수]

### P2-6. 에이전트 상태 영구 저장 [🔧 부분완료]
- **완료**: agent_state 테이블 스키마 + SupabaseAdapter CRUD
- **미완료**: 실제 5분 주기 저장 로직, 서버 재시작 시 복원

---

## ====== 명세서 Phase 3: 핵심 분석 기능 추가 (3~4주) ======

### P3-1. 3단계 이익 계산 [❌ 미착수]
- 제품이익 → 채널이익 → 사업부이익
- `computeContributionMargin()` 함수 신규 작성 필요
- **관련**: 명세서 §3.1, §9

### P3-2. ABC-XYZ 재고 분류 9칸 격자 [❌ 미착수]
- `computeABCXYZClassification()` 함수 신규 작성 필요
- 재고현황 탭에 히트맵 + 테이블 배지 추가
- **관련**: 명세서 §6.1

### P3-3. 신선도 점수 시스템 [❌ 미착수]
- `computeFreshnessScore()` 함수 신규 작성 필요
- 0~100점 자동 계산, 위험등급 5단계
- **관련**: 명세서 §6.1

### P3-4. 레시피 대비 투입 오차 분석 [❌ 미착수]
- `computeBomVariance()` 함수 신규 작성 필요
- 가격차이 + 수량차이 분리
- **관련**: 명세서 §5.3

### P3-5. 한계단가 계산 + 초과 경고 [❌ 미착수]
- `computeLimitPrice()` 함수 신규 작성 필요
- 원재료 테이블에 한계단가/초과율 컬럼 추가
- **관련**: 명세서 §4.2, §12.3

### P3-6. 설정 화면 파라미터 섹션 [✅ 완료]
- 원가설정, ABC-XYZ, 이상감지, 노무비, 발주, 채널비용, 뷰 표시 임계값 — 모두 구현됨

---

## ====== 명세서 Phase 4: 고급 분석 및 시뮬레이션 (4~6주) ======

### P4-1. "만약에?" 손익 시뮬레이션 패널 [❌ 미착수]
- 재료비/판매량/수수료 슬라이더 → 실시간 재계산
- **관련**: 명세서 §3.3

### P4-2. 본전 판매량(BEP) 자동 계산 [❌ 미착수]
- 품목별 BEP, 달성률, 여유비율 컬럼
- **관련**: 명세서 §3.2

### P4-3. 수율 추적 대시보드 [❌ 미착수]
- 기준수율 vs 실제수율, 환산단가
- **관련**: 명세서 §5.3, §12.2

### P4-4. 현금 흐름 대시보드 [❌ 미착수]
- 현금회수기간, 재고회전율, 당좌비율
- **관련**: 명세서 §12.1

### P4-5. 쌓아두는 비용 vs 버리는 비용 최적화 [❌ 미착수]
- **관련**: 명세서 §6.3

---

## ====== 명세서 Phase 5: 성능 및 사용성 (6~8주) ======

### P5-1. 가상 스크롤 + 페이지네이션 [❌ 미착수]
### P5-2. 서버 캐시 [❌ 미착수]
### P5-3. 요청 제한 (Rate Limiting) [❌ 미착수]
### P5-4. 실시간 연결 자동 재연결 [❌ 미착수]
### P5-5. 설정 내보내기/가져오기 [❌ 미착수]
### P5-6. PDF 월간 리포트 [❌ 미착수]

---

## ====== 인프라 작업 (명세서 이전에 완료) ======

### 완료된 인프라
- [x] BusinessConfig 중앙 관리 (30개+ 필드)
- [x] 3-Context 아키텍처 (Settings/Data/UI)
- [x] ErrorBoundary 화면별 오류 격리
- [x] Zod 검증 스키마
- [x] ChannelCostAdmin 기본 UI
- [x] 6개 서비스 BusinessConfig 파라미터 적용
- [x] SettingsView 7개 설정 섹션
- [x] Supabase channel_costs, agent_state 테이블 스키마
- [x] 4개 뷰 하드코딩 → config 참조 교체 (25곳)
- [x] InventoryOrderView computeStatisticalOrder 버그 수정

---

## 전체 진행률 요약

| Phase | 항목수 | ✅완료 | 🔧부분 | ❌미착수 | 진행률 |
|-------|--------|--------|--------|---------|--------|
| Phase 1 (핵심 고정값) | 8 | 3 | 3 | 2 | 56% |
| Phase 2 (보안/안정성) | 6 | 2 | 1 | 3 | 42% |
| Phase 3 (핵심 분석) | 6 | 1 | 0 | 5 | 17% |
| Phase 4 (고급 분석) | 5 | 0 | 0 | 5 | 0% |
| Phase 5 (성능/사용성) | 6 | 0 | 0 | 6 | 0% |
| **합계** | **31** | **6** | **4** | **21** | **~26%** |

## 다음 작업 (Now)

> **Phase 1의 미완료 항목부터 순서대로 진행**
>
> 1. ~~P1-5 서비스수준~~ ✅
> 2. ~~P1-6 안전재고~~ ✅
> 3. ~~P1-7 API키~~ ✅
> 4. **P1-4 경비 고정비+변동비** ← insightService 적용만 하면 됨 (가장 빠름)
> 5. **P1-2 폐기비용 품목별 단가** ← insightService 수정
> 6. **P1-8 채널 비용 어드민 고도화** ← DB 연동 + 비용유형 세분화
> 7. **P1-1 진짜 남는 돈 계산** ← P1-8 완료 후 가능 (가장 큰 작업)
> 8. **P1-3 노무비 반별 생산성** ← 새 화면 + DB 테이블

---

## 커밋 이력
| 커밋 | 내용 | 날짜 |
|------|------|------|
| 730498f | 비즈니스 설정 중앙 관리 고도화 (인프라) | 2026-02-09 |
| (미커밋) | 4개 뷰 하드코딩→config 교체 + 버그수정 | 2026-02-09 |
