{
  "project": "Z-CMS",
  "branchName": "ralph/view-data-enhancement",
  "description": "기존 뷰 개선 + 데이터 연동 강화 — 미연결 뷰 활성화, 미사용 데이터 연동, 하드코딩 제거",
  "userStories": [
    {
      "id": "US-001",
      "title": "insightService에 computeDailyPerformance 함수 추가",
      "description": "As a developer, I need a function to compute DailyPerformanceMetric[] from gsLabor + gsProduction + gsDailySales data.",
      "acceptanceCriteria": [
        "computeDailyPerformance(labor, production, dailySales, config) 함수를 insightService.ts에 추가",
        "LaborDailyData[] + ProductionData[] + DailySalesData[] → DailyPerformanceMetric[] 변환",
        "일별 노무비율 = 해당일 totalPay / 해당일 매출 × 100",
        "일별 원재료비율 = 해당일 구매비용(purchases) / 해당일 매출 × 100",
        "laborStatus/materialStatus/overallStatus 판정: target 대비 ±5% 이내 on-target, 초과 above-target, 미달 below-target",
        "StaffingSuggestion[] 생성: 노무비율 목표 초과일에 인력 조정 제안",
        "computeAllInsights()에 dailyPerformance 추가",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "LaborDailyData has: date, department, headcount, totalPay, weekdayTotalHours etc. ProductionData has: date, prodQtyTotal. DailySalesData has: date, totalAmount. targets default: laborRatio=25, materialRatio=45 (from SettingsContext config)."
    },
    {
      "id": "US-002",
      "title": "insightService에 computeMaterialPriceImpact 함수 추가",
      "description": "As a developer, I need a function to compute MaterialPriceHistory[] and MaterialCostImpact[] from purchase history.",
      "acceptanceCriteria": [
        "computeMaterialPriceImpact(purchases, bomData, materialMaster) 함수를 insightService.ts에 추가",
        "PurchaseData[]에서 자재별 일별 단가 이력(PricePoint[]) 추출",
        "MaterialPriceHistory: currentPrice, previousWeekPrice, previousMonthPrice, priceChangeWeek/Month, avgPrice30Days 계산",
        "MaterialCostImpact: 단가 변동이 5% 이상인 자재에 대해 BOM 연결 제품의 원가 영향 산출",
        "AffectedProduct[]: bomQty × (newPrice - oldPrice) = deltaCost per product",
        "urgencyLevel 판정: 10%이상=high, 5~10%=medium, 그 외=low",
        "computeAllInsights()에 materialPriceImpact 추가",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "PurchaseData has: date, productCode, productName, quantity, unitPrice, total. BomItemData links material→product. Use last 30 days of purchases for price history. Group by productCode, sort by date."
    },
    {
      "id": "US-003",
      "title": "DailyPerformanceView 라우팅 연결 + 데이터 전달",
      "description": "As a user, I want to access the daily performance tracking view from the main navigation.",
      "acceptanceCriteria": [
        "routeConfig.ts cost 탭에 { key: 'dailyPerformance', path: 'daily-performance' } 추가",
        "App.tsx에서 CostManagementView에 dailyPerformance prop 전달 (insights?.dailyPerformance)",
        "CostManagementView에서 activeTab === 'dailyPerformance' 시 DailyPerformanceView 렌더링",
        "DailyPerformanceView에 data, staffingSuggestions, targets props 전달",
        "targets는 SettingsContext의 config에서 laborRatio, materialRatio 가져오기",
        "데이터 없을 때 '노무비 데이터를 연동하면 일별 성과를 분석합니다' 안내 표시",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "DailyPerformanceView is already built at src/components/views/DailyPerformanceView.tsx. Just need to wire it into routing and pass data. CostManagementView renders tabs via SubTabLayout children function pattern."
    },
    {
      "id": "US-004",
      "title": "MaterialPriceImpactView 라우팅 연결 + 데이터 전달",
      "description": "As a user, I want to access material price impact analysis from the cost management view.",
      "acceptanceCriteria": [
        "routeConfig.ts cost 탭에 { key: 'priceImpact', path: 'price-impact' } 추가",
        "App.tsx에서 CostManagementView에 materialPriceImpact prop 전달",
        "CostManagementView에서 activeTab === 'priceImpact' 시 MaterialPriceImpactView 렌더링",
        "MaterialPriceImpactView에 priceHistory, impacts, onItemClick props 전달",
        "데이터 없을 때 '구매 데이터를 연동하면 단가 변동 분석을 제공합니다' 안내 표시",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "MaterialPriceImpactView is already built at src/components/views/MaterialPriceImpactView.tsx. Wire into cost view tabs. CostManagementView already has tabs array in render."
    },
    {
      "id": "US-005",
      "title": "InventoryOrderView 공급업체 목록 동적 추출",
      "description": "As a user, I want the supplier list to be derived from actual purchase data instead of being hardcoded.",
      "acceptanceCriteria": [
        "InventoryOrderView에서 하드코딩된 supplierList 상수 제거",
        "PurchaseData[]에서 고유 supplierName 추출하여 동적 공급업체 목록 생성",
        "공급업체별 최근 거래 횟수, 최근 거래일, 총 거래 금액 계산",
        "기존 주문 모달에서 동적 공급업체 목록 사용",
        "공급업체 데이터 없으면 '구매 데이터에서 공급업체 정보를 추출합니다' 안내",
        "하드코딩된 전화번호/이메일은 공급업체 정보가 없으면 빈값 처리",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Current hardcoded suppliers in InventoryOrderView: 6 items with phone/email. PurchaseData doesn't have supplierName field — check the actual PurchaseData interface. If no supplier field, extract from productName patterns or add comment explaining limitation."
    },
    {
      "id": "US-006",
      "title": "gsInventorySnapshots 재고 추이 분석 연동",
      "description": "As a user, I want to see inventory level trends over time using snapshot data.",
      "acceptanceCriteria": [
        "insightService.ts에 computeInventoryTrend(snapshots: InventorySnapshotData[]) 함수 추가",
        "자재별 일별 재고 수량 추이 계산 (snapshotDate 기준 그룹핑)",
        "재고 회전율 = 기간 출고량 / 평균 재고량 (purchases 데이터 활용)",
        "InventoryOrderView의 'inventoryCost' 탭에 재고 추이 차트 추가",
        "App.tsx에서 gsInventorySnapshots를 InventoryOrderView에 전달",
        "InventoryOrderView Props에 inventorySnapshots?: InventorySnapshotData[] 추가",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "InventorySnapshotData: { productCode, productName, balanceQty, warehouseCode, snapshotDate }. Currently gsInventorySnapshots is fetched by useSyncManager but never passed to any view. Add line chart showing balanceQty over time per material."
    },
    {
      "id": "US-007",
      "title": "gsChannelProfit 채널 수익 실데이터 연동",
      "description": "As a user, I want the profit analysis to use actual channel profit allocation data instead of computed estimates.",
      "acceptanceCriteria": [
        "App.tsx에서 gsChannelProfit을 ProfitAnalysisView에 전달",
        "ProfitAnalysisView Props에 channelProfit?: ChannelProfitData[] 추가",
        "channelProfit 데이터가 있으면 computeChannelRevenue 대신 실데이터 우선 사용",
        "채널별 실제 수익 vs 계산 수익 비교 뱃지 표시 (실데이터 기반 / 계산 기반)",
        "실데이터와 계산값의 차이가 10% 이상이면 경고 표시",
        "channelProfit 없으면 기존 computeChannelRevenue 로직 유지 (하위 호환)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "gsChannelProfit is fetched via Google Sheets sync but never used in any view. ChannelProfitData type should already exist in googleSheetService.ts. Check the actual type and see how it maps to ProfitAnalysisView's channel breakdown."
    }
  ]
}
